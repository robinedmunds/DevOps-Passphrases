# FIXME: nginx config test failing

language: ruby

services:
  - docker

# test build
before_install:
  - docker build -t proxy-testing ./proxy
  - docker build -t api-testing -f ./backend/Dockerfile.dev ./backend
  - docker run -d --name api-testing api-testing
  - docker -v
  - docker ps -a

# run tests
before_script:
  # - docker run -t proxy-testing /bin/sh -c "nginx -vtc /etc/nginx/conf.d/default.conf;"
  - docker exec api-testing /bin/sh -c "cd /usr/src/app && python -m pytest;"

# production build
script:
  - docker build -t roblobob/devops-passphrases-proxy ./proxy
  - docker build -t roblobob/devops-passphrases-api -f ./backend/Dockerfile.gunicorn ./backend
  - docker build -t roblobob/devops-passphrases-frontend ./frontend
# push to docker hub
# after_script:


